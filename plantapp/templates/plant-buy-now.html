<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buy Now</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <h2 class="text-center">Confirm Your Order</h2>
        
        <form method="post" action="">
            {% csrf_token %}

            <!-- Buyer Details Card -->
            <div class="card mb-3">
                <div class="card-header d-flex justify-content-between">
                    <h4>Buyer Details</h4>
                    <button type="button" class="btn btn-primary btn-sm" id="editUserBtn">Edit</button>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Name</label>
                        <input type="text" name="full_name" class="form-control user-input" value="{{ user.full_name }}" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" name="email" class="form-control user-input" value="{{ user.email }}" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Address</label>
                        <input type="text" name="address" class="form-control user-input" value="{{ user.address }}" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Phone</label>
                        <input type="text" name="phone_number" class="form-control user-input" value="{{ user.phone_number }}" readonly>
                    </div>
                    <button type="button" class="btn btn-success d-none" id="saveUserBtn">Save</button>
                </div>
            </div>

            <!-- Product Details Card -->
            <div class="card mb-3">
                <div class="card-header">
                    <h4>Product Details</h4>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Product Name</label>
                        <input type="text" name="plant_name" class="form-control" value="{{ plant.plant_name }}" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Available Stock</label>
                        <input type="text" class="form-control" value="{{ plant.quantity }}" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Select Quantity</label>
                        <input type="number" id="quantity" name="quantity" class="form-control" min="1" max="{{ plant.quantity }}" value="1" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Price per unit</label>
                        <input type="text" id="unit_price" class="form-control" value="₹{{ plant.price }}" data-price="{{ plant.price }}" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Delivery Charge</label>
                        <input type="text" id="delivery_charge" class="form-control" value="₹{{ plant.delivery_charge }}" data-charge="{{ plant.delivery_charge }}" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Protection Fee</label>
                        <input type="text" id="protection_fee" class="form-control" value="₹{{ plant.protection_fee }}" data-fee="{{ plant.protection_fee }}" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Total Payable</label>
                        <input type="text" id="total_payable" class="form-control" readonly>
                    </div>
                </div>
            </div>

            <!-- Payment Method Card -->
            <div class="card mb-3">
                <div class="card-header">
                    <h4>Payment Method</h4>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label>
                            <input type="radio" name="payment_method" value="COD" required>
                            Cash on Delivery
                        </label><br>
                        <label>
                            <input type="radio" name="payment_method" value="Card" required id="cardOption">
                            Card Payment
                        </label>
                    </div>

                    <div id="cardDetails" style="display: none;">
                        <div class="mb-3">
                            <label for="cardholder_name" class="form-label">Cardholder Name</label>
                            <input type="text" name="cardholder_name" class="form-control" value="{{ user.full_name }}" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="card_number" class="form-label">Card Number</label>
                            <input type="text" name="card_number" class="form-control" maxlength="16" placeholder="*** **** ******">
                        </div>
                        <div class="mb-3">
                            <label for="expiry_date" class="form-label">Expiry Date</label>
                            <input type="text" name="expiry_date" class="form-control" placeholder="MM/YYYY">
                        </div>
                        <div class="mb-3">
                            <label for="cvv" class="form-label">CVV</label>
                            <input type="text" name="cvv" class="form-control" maxlength="4" placeholder="***">
                        </div>
                    </div>
                </div>
            </div>

            <button type="submit" class="btn btn-success mt-3" id="placeOrderButton">Place Order</button>
        </form>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const quantityInput = document.getElementById("quantity");
            const unitPrice = parseFloat(document.getElementById("unit_price").dataset.price) || 0;
            const deliveryCharge = parseFloat(document.getElementById("delivery_charge").dataset.charge) || 0;
            const protectionFee = parseFloat(document.getElementById("protection_fee").dataset.fee) || 0;
            const totalPayableField = document.getElementById("total_payable");

            function updateTotal() {
                let quantity = parseInt(quantityInput.value) || 1;
                let total = (unitPrice * quantity) + deliveryCharge + protectionFee;
                totalPayableField.value = "₹" + total.toFixed(2);
            }

            quantityInput.addEventListener("input", updateTotal);
            updateTotal();

            document.getElementById("cardOption").addEventListener("change", function() {
                document.getElementById("cardDetails").style.display = "block";
            });

            document.querySelector("input[name='payment_method'][value='COD']").addEventListener("change", function() {
                document.getElementById("cardDetails").style.display = "none";
            });

            document.getElementById("editUserBtn").addEventListener("click", function() {
                document.querySelectorAll(".user-input").forEach(input => input.removeAttribute("readonly"));
                document.getElementById("saveUserBtn").classList.remove("d-none");
                this.classList.add("d-none");
            });

            document.getElementById("saveUserBtn").addEventListener("click", function() {
                document.querySelectorAll(".user-input").forEach(input => input.setAttribute("readonly", true));
                document.getElementById("editUserBtn").classList.remove("d-none");
                this.classList.add("d-none");
            });
        });
    </script>
</body>
</html>
